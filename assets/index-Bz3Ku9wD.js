(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Z=({likeButton:e,cardLikeCount:t,likeCount:o})=>{e.classList.toggle("card__like-button_is-active"),t.textContent=o},ee=e=>{e.remove()},te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),A=(e,t)=>e.some(o=>o._id===t),N=(e,t,{onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n,onInfoClick:c})=>{const s=te(),u=s.querySelector(".card__like-button"),M=s.querySelector(".card__control-button_type_delete"),v=s.querySelector(".card__image"),F=s.querySelector(".card__like-count"),X=s.querySelector(".card__control-button_type_info");if(v.src=e.link,v.alt=e.name,s.querySelector(".card__title").textContent=e.name,F.textContent=e.likes.length,A(e.likes,t)&&u.classList.add("card__like-button_is-active"),r){let P=A(e.likes,t);u.addEventListener("click",()=>r({likeButton:u,cardLikeCount:F,id:e._id,isLiked:P,setIsLiked:Y=>P=Y}))}return e.owner._id===t?M.addEventListener("click",()=>n({cardElement:s,id:e._id})):M.remove(),o&&v.addEventListener("click",()=>o({name:e.name,link:e.link})),c&&X.addEventListener("click",()=>c(e._id)),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},ne=e=>e.dataset.errorMessage&&e.validity.patternMismatch?e.dataset.errorMessage:e.validationMessage,re=(e,t,o,r)=>{t.classList.add(r.inputErrorClass);const n=e.querySelector(`#${t.id}-error`);n&&(n.textContent=o,n.classList.add(r.errorClass))},D=(e,t,o)=>{t.classList.remove(o.inputErrorClass);const r=e.querySelector(`#${t.id}-error`);r&&(r.textContent="",r.classList.remove(o.errorClass))},ce=(e,t,o)=>{if(t.validity.valid)D(e,t,o);else{const r=ne(t);re(e,t,r,o)}},se=e=>e.some(t=>!t.validity.valid),W=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},le=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},w=(e,t,o)=>{se(e)?W(t,o):le(t,o)},ie=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);w(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{ce(e,n,t),w(o,r,t)})})},ae=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{D(e,n,t)}),W(r,t)},ue=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ie(o,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"6b6cade9-22ab-4d4e-a31e-303dab5ddb66","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),pe=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(i),j=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(i),de=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(i),me=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify(e)}).then(i),_e=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(i),fe=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(i),ye=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>i(o)),J=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),m=q.querySelector(".popup__form"),V=m.querySelector(".popup__input_type_name"),H=m.querySelector(".popup__input_type_description"),C=m.querySelector(".popup__button"),he=C.textContent,g=document.querySelector(".popup_type_new-card"),_=g.querySelector(".popup__form"),Se=_.querySelector(".popup__input_type_card-name"),ve=_.querySelector(".popup__input_type_url"),b=_.querySelector(".popup__button"),Ce=b.textContent,f=document.querySelector(".popup_type_info"),be=f.querySelector(".popup__title"),T=f.querySelector(".popup__text"),p=f.querySelector(".popup__info"),U=f.querySelector(".popup__list"),k=document.querySelector(".popup_type_image"),$=k.querySelector(".popup__image"),Le=k.querySelector(".popup__caption"),qe=document.querySelector(".profile__edit-button"),ge=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),S=B.querySelector(".popup__form"),ke=S.querySelector(".popup__input"),L=S.querySelector(".popup__button"),Ee=L.textContent,R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let h;const z=({name:e,link:t})=>{$.src=t,$.alt=e,Le.textContent=e,d(k)},K=({likeButton:e,cardLikeCount:t,id:o,isLiked:r,setIsLiked:n})=>{ye(o,r).then(c=>{Z({likeButton:e,cardLikeCount:t,likeCount:c.likes.length});const s=c.likes.some(u=>u._id===h);n(s)}).catch(c=>{console.log(c)})},G=({cardElement:e,id:t})=>{fe(t).then(()=>{ee(e)}).catch(o=>{console.log(o)})},Ie=e=>{e.preventDefault(),C.textContent="Сохранение...",de({name:V.value,about:H.value}).then(t=>{E.textContent=t.name,I.textContent=t.about,a(q)}).catch(t=>{console.log(t)}).finally(()=>{C.textContent=he})},xe=e=>{e.preventDefault(),L.textContent="Сохранение...",me({avatar:ke.value}).then(t=>{x.style.backgroundImage=`url(${t.avatar})`}).catch(t=>{console.log(t)}).finally(()=>{L.textContent=Ee}),a(B)},Be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),y=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Me=e=>{const t=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},Q=e=>{be.textContent="Информация о карточке",T.textContent="",p.textContent="",U.textContent="",j().then(t=>t.find(o=>o._id===e)).then(t=>{p.append(y("Описание:",t.name)),p.append(y("Дата создания:",Be(new Date(t.createdAt)))),p.append(y("Владелец:",t.owner.name)),p.append(y("Количество лайков:",t.likes.length)),t.likes.length&&(T.textContent="Лайкнули:",t.likes.forEach(o=>U.append(Me(o.name)))),d(f)}).catch(t=>{console.log(t)})},Fe=e=>{e.preventDefault(),b.textContent="Создание...",_e({name:Se.value,link:ve.value}).then(t=>{J.prepend(N(t,h,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:G,onInfoClick:Q}))}).catch(t=>{console.log(t)}).finally(()=>{b.textContent=Ce}),a(g)};m.addEventListener("submit",Ie);_.addEventListener("submit",Fe);S.addEventListener("submit",xe);qe.addEventListener("click",()=>{V.value=E.textContent,H.value=I.textContent,ae(m,R),d(q)});x.addEventListener("click",()=>{S.reset(),d(B)});ge.addEventListener("click",()=>{_.reset(),d(g)});ue(R);const Pe=document.querySelectorAll(".popup");Pe.forEach(e=>{oe(e)});Promise.all([j(),pe()]).then(([e,t])=>{h=t._id,E.textContent=t.name,I.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{J.append(N(o,h,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:G,onInfoClick:Q}))})}).catch(e=>{console.log(e)});
